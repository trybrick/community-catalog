lb-prerender:
  image: rancher/load-balancer-service
  ports:
    - 4001:3000
  links:
    - prerender:prerender
  labels:
    # Put load balancer containers on hosts with label
    io.rancher.scheduler.affinity:host_label: ${LB_HOST}

prerender:
  image: niiknow/prerender-redis:1.0.6
  labels:
    # Make prerender a global service
    io.rancher.scheduler.global: 'true'
  links:
    - redis:redis
  restart: always
  environment:
    REDIS_URL: "${REDIS_URL}"
    PAGE_TTL: ${PAGE_TTL}
    BASIC_AUTH_USERNAME: "${BASIC_AUTH_USERNAME}"
    BASIC_AUTH_PASSWORD: "${BASIC_AUTH_PASSWORD}"
    PRERENDER_NUM_WORKERS: ${PRERENDER_NUM_WORKERS}

redis:
  image: niiknow/redis:0.0.4
  restart: always
  labels:
    io.rancher.container.hostname_override: container_name
